/*
 @license GNU Affero General Public License.
 Copyright (c) 2015-2018 Ronny Lorenz <ronny@tbi.univie.ac.at>
 v. 1.2.3
 https://github.com/RaumZeit/MarchingSquares.js
*/
(function(x,B){"function"===typeof define&&define.amd?define([],function(){return{isoBands:B()}}):"object"===typeof module&&module.exports?module.exports={isoBands:B()}:x.MarchingSquaresJS={isoBands:B(),isoContours:x.MarchingSquaresJS?x.MarchingSquaresJS.isoContours:null}})(this,function(){function x(d,b,c,g,h,a){d=(g+c+b+d)/4;return d>a?2:d<h?0:1}function B(d,b,c,g){0===c?(d+=1,b+=g[0][1]):1===c?d+=g[0][0]:2===c?b+=g[0][1]:3===c&&(d+=g[0][0],b+=1);return[d,b]}function I(d,b,c){0===c?d++:1!==c&&(2===
c?b++:3===c&&(d++,b++));return[d,b]}function J(d,b){for(var c=d.rows,g=d.cols,h=[],a=0;a<c;a++)for(var f=0;f<g;f++)if("undefined"!==typeof d.cells[a][f]){var t=d.cells[a][f];0!==t.cval&&170!==t.cval&&t.polygons.forEach(function(c){c.forEach(function(b){b[0]+=f;b[1]+=a});b.linearRing&&c.push(c[0]);h.push(c)})}return h}var F={successCallback:null,verbose:!1,polygons:!1,polygons_full:!1,linearRing:!0,interpolate:function(d,b,c,g){return d<b?d<c?(c-d)/(b-d):(g-d)/(b-d):d>g?(d-g)/(d-b):(d-c)/(d-b)},interpolate_a:function(d,
b,c,g){return d<b?(c-d)/(b-d):(d-g)/(d-b)},interpolate_b:function(d,b,c,g){return d<b?(g-d)/(b-d):(d-c)/(d-b)}},f={square:function(d,b,c,g,h,a){a.polygons&&d.polygons.push([[0,0],[0,1],[1,1],[1,0]])},triangle_bl:function(d,b,c,g,h,a){c=a.interpolate(b,c,a.minV,a.maxV);b=a.interpolate(b,h,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,b],[c,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&d.polygons.push([[0,b],[c,0],[0,0]])},triangle_br:function(d,b,c,g,h,a){b=a.interpolate(b,c,a.minV,a.maxV);
c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[b,0],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[b,0],[1,c],[1,0]])},triangle_tr:function(d,b,c,g,h,a){b=a.interpolate(c,g,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);a.polygons_full&&(d.edges.rt={path:[[1,b],[g,1]],move:{x:0,y:1,enter:"br"}});a.polygons&&d.polygons.push([[1,b],[g,1],[1,1]])},triangle_tl:function(d,b,c,g,h,a){c=a.interpolate(h,g,a.minV,a.maxV);b=a.interpolate(b,h,a.minV,a.maxV);a.polygons_full&&
(d.edges.tl={path:[[c,1],[0,b]],move:{x:-1,y:0,enter:"rt"}});a.polygons&&d.polygons.push([[0,b],[0,1],[c,1]])},tetragon_t:function(d,b,c,g,h,a){c=a.interpolate(c,g,a.minV,a.maxV);b=a.interpolate(b,h,a.minV,a.maxV);a.polygons_full&&(d.edges.rt={path:[[1,c],[0,b]],move:{x:-1,y:0,enter:"rt"}});a.polygons&&d.polygons.push([[0,b],[0,1],[1,1],[1,c]])},tetragon_r:function(d,b,c,g,h,a){b=a.interpolate(b,c,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[b,0],[g,1]],move:{x:0,
y:1,enter:"br"}});a.polygons&&d.polygons.push([[b,0],[g,1],[1,1],[1,0]])},tetragon_b:function(d,b,c,g,h,a){b=a.interpolate(b,h,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,b],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[0,0],[0,b],[1,c],[1,0]])},tetragon_l:function(d,b,c,g,h,a){g=a.interpolate(h,g,a.minV,a.maxV);b=a.interpolate(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.tl={path:[[g,1],[b,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&
d.polygons.push([[0,0],[0,1],[g,1],[b,0]])},tetragon_bl:function(d,b,c,g,h,a){g=a.interpolate_a(b,c,a.minV,a.maxV);c=a.interpolate_b(b,c,a.minV,a.maxV);var f=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[g,0],[0,f]],move:{x:-1,y:0,enter:"rb"}},d.edges.lt={path:[[0,b],[c,0]],move:{x:0,y:-1,enter:"tr"}});a.polygons&&d.polygons.push([[g,0],[0,f],[0,b],[c,0]])},tetragon_br:function(d,b,c,g,h,a){h=a.interpolate_a(b,c,a.minV,a.maxV);b=a.interpolate_b(b,
c,a.minV,a.maxV);var f=a.interpolate_a(c,g,a.minV,a.maxV);c=a.interpolate_b(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[h,0],[1,c]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,f],[b,0]],move:{x:0,y:-1,enter:"tr"}});a.polygons&&d.polygons.push([[h,0],[1,c],[1,f],[b,0]])},tetragon_tr:function(d,b,c,g,h,a){b=a.interpolate_a(h,g,a.minV,a.maxV);h=a.interpolate_b(h,g,a.minV,a.maxV);var f=a.interpolate_b(c,g,a.minV,a.maxV);c=a.interpolate_a(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.rb=
{path:[[1,c],[b,1]],move:{x:0,y:1,enter:"bl"}},d.edges.tr={path:[[h,1],[1,f]],move:{x:1,y:0,enter:"lt"}});a.polygons&&d.polygons.push([[1,c],[b,1],[h,1],[1,f]])},tetragon_tl:function(d,b,c,g,h,a){c=a.interpolate_a(h,g,a.minV,a.maxV);g=a.interpolate_b(h,g,a.minV,a.maxV);var f=a.interpolate_b(b,h,a.minV,a.maxV);b=a.interpolate_a(b,h,a.minV,a.maxV);a.polygons_full&&(d.edges.tr={path:[[g,1],[0,b]],move:{x:-1,y:0,enter:"rb"}},d.edges.lt={path:[[0,f],[c,1]],move:{x:0,y:1,enter:"bl"}});a.polygons&&d.polygons.push([[g,
1],[0,b],[0,f],[c,1]])},tetragon_lr:function(d,b,c,g,h,a){var f=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);h=a.interpolate_b(c,g,a.minV,a.maxV);c=a.interpolate_a(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.lt={path:[[0,b],[1,h]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,c],[0,f]],move:{x:-1,y:0,enter:"rb"}});a.polygons&&d.polygons.push([[0,f],[0,b],[1,h],[1,c]])},tetragon_tb:function(d,b,c,g,h,a){var f=a.interpolate_a(h,g,a.minV,a.maxV);g=a.interpolate_b(h,g,a.minV,
a.maxV);h=a.interpolate_b(b,c,a.minV,a.maxV);b=a.interpolate_a(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.tr={path:[[g,1],[h,0]],move:{x:0,y:-1,enter:"tr"}},d.edges.bl={path:[[b,0],[f,1]],move:{x:0,y:1,enter:"bl"}});a.polygons&&d.polygons.push([[b,0],[f,1],[g,1],[h,0]])},pentagon_tr:function(d,b,c,g,h,a){b=a.interpolate(h,g,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.tl={path:[[b,1],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[0,0],[0,1],[b,1],
[1,c],[1,0]])},pentagon_tl:function(d,b,c,g,h,a){b=a.interpolate(b,h,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,b],[g,1]],move:{x:0,y:1,enter:"br"}});a.polygons&&d.polygons.push([[0,0],[0,b],[g,1],[1,1],[1,0]])},pentagon_br:function(d,b,c,g,h,a){b=a.interpolate(b,c,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.rt={path:[[1,c],[b,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&d.polygons.push([[0,0],[0,1],[1,1],[1,c],[b,0]])},
pentagon_bl:function(d,b,c,g,h,a){g=a.interpolate(b,h,a.minV,a.maxV);b=a.interpolate(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[b,0],[0,g]],move:{x:-1,y:0,enter:"rt"}});a.polygons&&d.polygons.push([[0,g],[0,1],[1,1],[1,0],[b,0]])},pentagon_tr_rl:function(d,b,c,g,h,a){b=a.interpolate(b,h,a.minV,a.maxV);h=a.interpolate(h,g,a.minV,a.maxV);var f=a.interpolate_b(c,g,a.minV,a.maxV);c=a.interpolate_a(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.tl={path:[[h,1],[1,f]],move:{x:1,y:0,enter:"lt"}},
d.edges.rb={path:[[1,c],[0,b]],move:{x:-1,y:0,enter:"rt"}});a.polygons&&d.polygons.push([[0,b],[0,1],[h,1],[1,f],[1,c]])},pentagon_rb_bt:function(d,b,c,g,h,a){var f=a.interpolate(c,g,a.minV,a.maxV),t=a.interpolate_b(b,c,a.minV,a.maxV);b=a.interpolate_a(b,c,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);a.polygons_full&&(d.edges.rt={path:[[1,f],[t,0]],move:{x:0,y:-1,enter:"tr"}},d.edges.bl={path:[[b,0],[g,1]],move:{x:0,y:1,enter:"br"}});a.polygons&&d.polygons.push([[g,1],[1,1],[1,f],[t,0],[b,0]])},
pentagon_bl_lr:function(d,b,c,g,h,a){var f=a.interpolate(b,c,a.minV,a.maxV),t=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[f,0],[0,t]],move:{x:-1,y:0,enter:"rb"}},d.edges.lt={path:[[0,b],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[f,0],[0,t],[0,b],[1,c],[1,0]])},pentagon_lt_tb:function(d,b,c,g,h,a){var f=a.interpolate(b,h,a.minV,a.maxV),t=a.interpolate_a(h,g,a.minV,a.maxV);g=a.interpolate_b(h,
g,a.minV,a.maxV);b=a.interpolate(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,f],[t,1]],move:{x:0,y:1,enter:"bl"}},d.edges.tr={path:[[g,1],[b,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&d.polygons.push([[0,0],[0,f],[t,1],[g,1],[b,0]])},pentagon_bl_tb:function(d,b,c,g,h,a){var f=a.interpolate(b,h,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);h=a.interpolate_b(b,c,a.minV,a.maxV);b=a.interpolate_a(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[b,0],[0,f]],move:{x:-1,y:0,enter:"rt"}},
d.edges.tl={path:[[g,1],[h,0]],move:{x:0,y:-1,enter:"tr"}});a.polygons&&d.polygons.push([[0,f],[0,1],[g,1],[h,0],[b,0]])},pentagon_lt_rl:function(d,b,c,g,h,a){var f=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);c=a.interpolate(c,h,a.minV,a.maxV);a.polygons_full&&(d.edges.lt={path:[[0,b],[g,1]],move:{x:0,y:1,enter:"br"}},d.edges.rt={path:[[1,c],[0,f]],move:{x:-1,y:0,enter:"rb"}});a.polygons&&d.polygons.push([[0,f],[0,b],[g,1],[1,1],[1,c]])},
pentagon_tr_bt:function(d,b,c,g,h,a){var f=a.interpolate_a(h,g,a.minV,a.maxV);h=a.interpolate_b(h,g,a.minV,a.maxV);g=a.interpolate(c,g,a.minV,a.maxV);b=a.interpolate(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[b,0],[f,1]],move:{x:0,y:1,enter:"bl"}},d.edges.tr={path:[[h,1],[1,g]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[f,1],[h,1],[1,g],[1,0],[b,0]])},pentagon_rb_lr:function(d,b,c,g,h,a){h=a.interpolate(b,h,a.minV,a.maxV);var f=a.interpolate_b(c,g,a.minV,a.maxV);g=a.interpolate_a(c,
g,a.minV,a.maxV);b=a.interpolate(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,h],[1,f]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,g],[b,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&d.polygons.push([[0,0],[0,h],[1,f],[1,g],[b,0]])},hexagon_lt_tr:function(d,b,c,g,h,a){b=a.interpolate(b,h,a.minV,a.maxV);var f=a.interpolate_a(h,g,a.minV,a.maxV);h=a.interpolate_b(h,g,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,b],[f,1]],move:{x:0,y:1,enter:"bl"}},
d.edges.tr={path:[[h,1],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[0,0],[0,b],[f,1],[h,1],[1,c],[1,0]])},hexagon_bl_lt:function(d,b,c,g,h,a){c=a.interpolate(b,c,a.minV,a.maxV);var f=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);g=a.interpolate(h,g,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[c,0],[0,f]],move:{x:-1,y:0,enter:"rb"}},d.edges.lt={path:[[0,b],[g,1]],move:{x:0,y:1,enter:"br"}});a.polygons&&d.polygons.push([[c,0],[0,f],[0,b],[g,1],[1,
1],[1,0]])},hexagon_bl_rb:function(d,b,c,g,h,a){var f=a.interpolate_a(b,c,a.minV,a.maxV),t=a.interpolate_b(b,c,a.minV,a.maxV);b=a.interpolate(b,h,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[f,0],[0,b]],move:{x:-1,y:0,enter:"rt"}},d.edges.rt={path:[[1,c],[t,0]],move:{x:0,y:-1,enter:"tr"}});a.polygons&&d.polygons.push([[f,0],[0,b],[0,1],[1,1],[1,c],[t,0]])},hexagon_tr_rb:function(d,b,c,g,h,a){b=a.interpolate(b,c,a.minV,a.maxV);h=a.interpolate(h,g,a.minV,a.maxV);
var f=a.interpolate_b(c,g,a.minV,a.maxV);c=a.interpolate_a(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.tl={path:[[h,1],[1,f]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,c],[b,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&d.polygons.push([[0,0],[0,1],[h,1],[1,f],[1,c],[b,0]])},hexagon_lt_rb:function(d,b,c,g,h,a){var f=a.interpolate(b,h,a.minV,a.maxV);h=a.interpolate(h,g,a.minV,a.maxV);g=a.interpolate(c,g,a.minV,a.maxV);b=a.interpolate(b,c,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,
f],[h,1]],move:{x:0,y:1,enter:"br"}},d.edges.rt={path:[[1,g],[b,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&d.polygons.push([[0,0],[0,f],[h,1],[1,1],[1,g],[b,0]])},hexagon_bl_tr:function(d,b,c,g,h,a){var f=a.interpolate(b,c,a.minV,a.maxV);b=a.interpolate(b,h,a.minV,a.maxV);h=a.interpolate(h,g,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[f,0],[0,b]],move:{x:-1,y:0,enter:"rt"}},d.edges.tl={path:[[h,1],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[f,
0],[0,b],[0,1],[h,1],[1,c],[1,0]])},heptagon_tr:function(d,b,c,g,h,a){var f=a.interpolate_a(b,c,a.minV,a.maxV),t=a.interpolate_b(b,c,a.minV,a.maxV),w=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);h=a.interpolate(h,g,a.minV,a.maxV);c=a.interpolate(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[f,0],[0,w]],move:{x:-1,y:0,enter:"rb"}},d.edges.lt={path:[[0,b],[h,1]],move:{x:0,y:1,enter:"br"}},d.edges.rt={path:[[1,c],[t,0]],move:{x:0,y:-1,enter:"tr"}});a.polygons&&d.polygons.push([[f,
0],[0,w],[0,b],[h,1],[1,1],[1,c],[t,0]])},heptagon_bl:function(d,b,c,g,f,a){var h=a.interpolate(b,c,a.minV,a.maxV);b=a.interpolate(b,f,a.minV,a.maxV);var t=a.interpolate_a(f,g,a.minV,a.maxV);f=a.interpolate_b(f,g,a.minV,a.maxV);var w=a.interpolate_b(c,g,a.minV,a.maxV);c=a.interpolate_a(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.lb={path:[[0,b],[t,1]],move:{x:0,y:1,enter:"bl"}},d.edges.tr={path:[[f,1],[1,w]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,c],[h,0]],move:{x:0,y:-1,enter:"tl"}});a.polygons&&
d.polygons.push([[0,0],[0,b],[t,1],[f,1],[1,w],[1,c],[h,0]])},heptagon_tl:function(d,b,c,g,f,a){var h=a.interpolate_a(b,c,a.minV,a.maxV),t=a.interpolate_b(b,c,a.minV,a.maxV);b=a.interpolate(b,f,a.minV,a.maxV);f=a.interpolate(f,g,a.minV,a.maxV);var w=a.interpolate_b(c,g,a.minV,a.maxV);c=a.interpolate_a(c,g,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[h,0],[0,b]],move:{x:-1,y:0,enter:"rt"}},d.edges.tl={path:[[f,1],[1,w]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,c],[t,0]],move:{x:0,y:-1,
enter:"tr"}});a.polygons&&d.polygons.push([[h,0],[0,b],[0,1],[f,1],[1,w],[1,c],[t,0]])},heptagon_br:function(d,b,c,f,h,a){var g=a.interpolate(b,c,a.minV,a.maxV),t=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);var w=a.interpolate_a(h,f,a.minV,a.maxV);h=a.interpolate_b(h,f,a.minV,a.maxV);c=a.interpolate(c,f,a.minV,a.maxV);a.polygons_full&&(d.edges.br={path:[[g,0],[0,t]],move:{x:-1,y:0,enter:"rb"}},d.edges.lt={path:[[0,b],[w,1]],move:{x:0,y:1,enter:"bl"}},d.edges.tr={path:[[h,
1],[1,c]],move:{x:1,y:0,enter:"lb"}});a.polygons&&d.polygons.push([[g,0],[0,t],[0,b],[w,1],[h,1],[1,c],[1,0]])},octagon:function(d,b,c,f,h,a){var g=a.interpolate_a(b,c,a.minV,a.maxV),t=a.interpolate_b(b,c,a.minV,a.maxV),w=a.interpolate_a(b,h,a.minV,a.maxV);b=a.interpolate_b(b,h,a.minV,a.maxV);var q=a.interpolate_a(h,f,a.minV,a.maxV);h=a.interpolate_b(h,f,a.minV,a.maxV);var r=a.interpolate_b(c,f,a.minV,a.maxV);c=a.interpolate_a(c,f,a.minV,a.maxV);a.polygons_full&&(d.edges.bl={path:[[g,0],[0,w]],move:{x:-1,
y:0,enter:"rb"}},d.edges.lt={path:[[0,b],[q,1]],move:{x:0,y:1,enter:"bl"}},d.edges.tr={path:[[h,1],[1,r]],move:{x:1,y:0,enter:"lt"}},d.edges.rb={path:[[1,c],[t,0]],move:{x:0,y:-1,enter:"tr"}});a.polygons&&d.polygons.push([[g,0],[0,w],[0,b],[q,1],[h,1],[1,r],[1,c],[t,0]])}};return function(d,b,c,g){var h={};g=g?g:{};for(var a=Object.keys(F),z=0;z<a.length;z++){var t=a[z],w=g[t];w="undefined"!==typeof w&&null!==w?w:F[t];h[t]=w}h.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+
b+":"+(b+c)+"]");h.polygons_full=!h.polygons;g=d.length-1;a=d[0].length-1;c=b+Math.abs(c);h.minV=b;h.maxV=c;b={rows:g,cols:a,cells:[],minV:b,maxV:c};for(c=0;c<g;++c)for(b.cells[c]=[],z=0;z<a;++z){t=b.cells[c];w=z;var q=h;var r=0;var k=d[c+1][z],l=d[c+1][z+1],m=d[c][z+1],n=d[c][z],v=q.minV,u=q.maxV;if(isNaN(n)||isNaN(m)||isNaN(l)||isNaN(k))q=void 0;else{r=r|(k<v?0:k>u?128:64)|(l<v?0:l>u?32:16);r|=m<v?0:m>u?8:4;r|=n<v?0:n>u?2:1;r=+r;var p={cval:r,polygons:[],edges:{},x0:n,x1:m,x2:l,x3:k};switch(r){case 85:f.square(p,
n,m,l,k,q);case 0:case 170:break;case 169:f.triangle_bl(p,n,m,l,k,q);break;case 166:f.triangle_br(p,n,m,l,k,q);break;case 154:f.triangle_tr(p,n,m,l,k,q);break;case 106:f.triangle_tl(p,n,m,l,k,q);break;case 1:f.triangle_bl(p,n,m,l,k,q);break;case 4:f.triangle_br(p,n,m,l,k,q);break;case 16:f.triangle_tr(p,n,m,l,k,q);break;case 64:f.triangle_tl(p,n,m,l,k,q);break;case 168:f.tetragon_bl(p,n,m,l,k,q);break;case 162:f.tetragon_br(p,n,m,l,k,q);break;case 138:f.tetragon_tr(p,n,m,l,k,q);break;case 42:f.tetragon_tl(p,
n,m,l,k,q);break;case 2:f.tetragon_bl(p,n,m,l,k,q);break;case 8:f.tetragon_br(p,n,m,l,k,q);break;case 32:f.tetragon_tr(p,n,m,l,k,q);break;case 128:f.tetragon_tl(p,n,m,l,k,q);break;case 5:f.tetragon_b(p,n,m,l,k,q);break;case 20:f.tetragon_r(p,n,m,l,k,q);break;case 80:f.tetragon_t(p,n,m,l,k,q);break;case 65:f.tetragon_l(p,n,m,l,k,q);break;case 165:f.tetragon_b(p,n,m,l,k,q);break;case 150:f.tetragon_r(p,n,m,l,k,q);break;case 90:f.tetragon_t(p,n,m,l,k,q);break;case 105:f.tetragon_l(p,n,m,l,k,q);break;
case 160:f.tetragon_lr(p,n,m,l,k,q);break;case 130:f.tetragon_tb(p,n,m,l,k,q);break;case 10:f.tetragon_lr(p,n,m,l,k,q);break;case 40:f.tetragon_tb(p,n,m,l,k,q);break;case 101:f.pentagon_tr(p,n,m,l,k,q);break;case 149:f.pentagon_tl(p,n,m,l,k,q);break;case 86:f.pentagon_bl(p,n,m,l,k,q);break;case 89:f.pentagon_br(p,n,m,l,k,q);break;case 69:f.pentagon_tr(p,n,m,l,k,q);break;case 21:f.pentagon_tl(p,n,m,l,k,q);break;case 84:f.pentagon_bl(p,n,m,l,k,q);break;case 81:f.pentagon_br(p,n,m,l,k,q);break;case 96:f.pentagon_tr_rl(p,
n,m,l,k,q);break;case 24:f.pentagon_rb_bt(p,n,m,l,k,q);break;case 6:f.pentagon_bl_lr(p,n,m,l,k,q);break;case 129:f.pentagon_lt_tb(p,n,m,l,k,q);break;case 74:f.pentagon_tr_rl(p,n,m,l,k,q);break;case 146:f.pentagon_rb_bt(p,n,m,l,k,q);break;case 164:f.pentagon_bl_lr(p,n,m,l,k,q);break;case 41:f.pentagon_lt_tb(p,n,m,l,k,q);break;case 66:f.pentagon_bl_tb(p,n,m,l,k,q);break;case 144:f.pentagon_lt_rl(p,n,m,l,k,q);break;case 36:f.pentagon_tr_bt(p,n,m,l,k,q);break;case 9:f.pentagon_rb_lr(p,n,m,l,k,q);break;
case 104:f.pentagon_bl_tb(p,n,m,l,k,q);break;case 26:f.pentagon_lt_rl(p,n,m,l,k,q);break;case 134:f.pentagon_tr_bt(p,n,m,l,k,q);break;case 161:f.pentagon_rb_lr(p,n,m,l,k,q);break;case 37:f.hexagon_lt_tr(p,n,m,l,k,q);break;case 148:f.hexagon_bl_lt(p,n,m,l,k,q);break;case 82:f.hexagon_bl_rb(p,n,m,l,k,q);break;case 73:f.hexagon_tr_rb(p,n,m,l,k,q);break;case 133:f.hexagon_lt_tr(p,n,m,l,k,q);break;case 22:f.hexagon_bl_lt(p,n,m,l,k,q);break;case 88:f.hexagon_bl_rb(p,n,m,l,k,q);break;case 97:f.hexagon_tr_rb(p,
n,m,l,k,q);break;case 145:f.hexagon_lt_rb(p,n,m,l,k,q);break;case 25:f.hexagon_lt_rb(p,n,m,l,k,q);break;case 70:f.hexagon_bl_tr(p,n,m,l,k,q);break;case 100:f.hexagon_bl_tr(p,n,m,l,k,q);break;case 17:r=x(n,m,l,k,v,u);0===r?(f.triangle_bl(p,n,m,l,k,q),f.triangle_tr(p,n,m,l,k,q)):f.hexagon_lt_rb(p,n,m,l,k,q);break;case 68:r=x(n,m,l,k,v,u);0===r?(f.triangle_tl(p,n,m,l,k,q),f.triangle_br(p,n,m,l,k,q)):f.hexagon_bl_tr(p,n,m,l,k,q);break;case 153:r=x(n,m,l,k,v,u);2===r?(f.triangle_bl(p,n,m,l,k,q),f.triangle_tr(p,
n,m,l,k,q)):f.hexagon_lt_rb(p,n,m,l,k,q);break;case 102:r=x(n,m,l,k,v,u);2===r?(f.triangle_tl(p,n,m,l,k,q),f.triangle_br(p,n,m,l,k,q)):f.hexagon_bl_tr(p,n,m,l,k,q);break;case 152:r=x(n,m,l,k,v,u);2===r?(f.triangle_tr(p,n,m,l,k,q),f.tetragon_bl(p,n,m,l,k,q)):f.heptagon_tr(p,n,m,l,k,q);break;case 137:r=x(n,m,l,k,v,u);2===r?(f.triangle_bl(p,n,m,l,k,q),f.tetragon_tr(p,n,m,l,k,q)):f.heptagon_bl(p,n,m,l,k,q);break;case 98:r=x(n,m,l,k,v,u);2===r?(f.triangle_tl(p,n,m,l,k,q),f.tetragon_br(p,n,m,l,k,q)):f.heptagon_tl(p,
n,m,l,k,q);break;case 38:r=x(n,m,l,k,v,u);2===r?(f.triangle_br(p,n,m,l,k,q),f.tetragon_tl(p,n,m,l,k,q)):f.heptagon_br(p,n,m,l,k,q);break;case 18:r=x(n,m,l,k,v,u);0===r?(f.triangle_tr(p,n,m,l,k,q),f.tetragon_bl(p,n,m,l,k,q)):f.heptagon_tr(p,n,m,l,k,q);break;case 33:r=x(n,m,l,k,v,u);0===r?(f.triangle_bl(p,n,m,l,k,q),f.tetragon_tr(p,n,m,l,k,q)):f.heptagon_bl(p,n,m,l,k,q);break;case 72:r=x(n,m,l,k,v,u);0===r?(f.triangle_tl(p,n,m,l,k,q),f.tetragon_br(p,n,m,l,k,q)):f.heptagon_tl(p,n,m,l,k,q);break;case 132:r=
x(n,m,l,k,v,u);0===r?(f.triangle_br(p,n,m,l,k,q),f.tetragon_tl(p,n,m,l,k,q)):f.heptagon_br(p,n,m,l,k,q);break;case 136:r=x(n,m,l,k,v,u);0===r?(f.tetragon_tl(p,n,m,l,k,q),f.tetragon_br(p,n,m,l,k,q)):1===r?f.octagon(p,n,m,l,k,q):(f.tetragon_bl(p,n,m,l,k,q),f.tetragon_tr(p,n,m,l,k,q));break;case 34:r=x(n,m,l,k,v,u),0===r?(f.tetragon_bl(p,n,m,l,k,q),f.tetragon_tr(p,n,m,l,k,q)):1===r?f.octagon(p,n,m,l,k,q):(f.tetragon_tl(p,n,m,l,k,q),f.tetragon_br(p,n,m,l,k,q))}q=p}t[w]=q}if(h.polygons)h.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),
b=J(b,h);else{h.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid");d=b.rows;g=b.cols;a=[];c=[["rt","rb"],["br","bl"],["lb","lt"],["tl","tr"]];z=[0,-1,0,1];t=[-1,0,1,0];w="bl lb lt tl tr rt rb br".split(" ");q={bl:1,br:1,lb:2,lt:2,tl:3,tr:3,rt:0,rb:0};m=!0;for(k=0;k<d;k++)if(b.cells[k][0].x0<b.minV||b.cells[k][0].x0>b.maxV||b.cells[k][g-1].x1<b.minV||b.cells[k][g-1].x1>b.maxV){m=!1;break}m&&(b.cells[d-1][0].x3<b.minV||b.cells[d-1][0].x3>b.maxV||b.cells[d-
1][g-1].x2<b.minV||b.cells[d-1][g-1].x2>b.maxV)&&(m=!1);if(m)for(l=0;l<g-1;l++)if(b.cells[0][l].x1<b.minV||b.cells[0][l].x1>b.maxV||b.cells[d-1][l].x2<b.minV||b.cells[d-1][l].x2>b.maxV){m=!1;break}m&&(h.linearRing?a.push([[0,0],[0,d],[g,d],[g,0],[0,0]]):a.push([[0,0],[0,d],[g,d],[g,0]]));for(k=0;k<d;k++)for(l=0;l<g;l++)if("undefined"!==typeof b.cells[k][l]&&(m=b.cells[k][l],0!==m.cval&&85!==m.cval&&170!==m.cval))for(e=0;8>e;e++)if(n=w[e],"object"===typeof m.edges[n]){p=[];var A=m.edges[n];r=n;v=l;
u=k;var G=!1,C=[l+A.path[0][0],k+A.path[0][1]];for(p.push(C);!G;){cc=b.cells[u][v];if("object"!==typeof cc.edges[r])break;A=cc.edges[r];delete cc.edges[r];point=A.path[1];point[0]+=v;point[1]+=u;p.push(point);r=A.move.enter;v+=A.move.x;u+=A.move.y;if("undefined"===typeof b.cells[u]||"undefined"===typeof b.cells[u][v]){var y=0,H=0;v===g?(v--,y=0):0>v?(v++,y=2):u===d?(u--,y=3):0>u&&(u++,y=1);if(v===l&&u===k&&y===q[n])break;for(;;){A=!1;if(4<H){console.log("Direction change counter overflow! This should never happen!");
break}cc=b.cells[u][v];for(var D=0;D<c[y].length;D++){var E=c[y][D];if("object"===typeof cc.edges[E]){A=cc.edges[E];p.push(B(v,u,y,A.path));r=E;A=!0;break}}if(A)break;else{p.push(I(v,u,y));v+=z[y];u+=t[y];if("undefined"===typeof b.cells[u]||"undefined"===typeof b.cells[u][v])v-=z[y],u-=t[y],y=(y+1)%4,H++;if(v===l&&u===k&&y===q[n]){G=!0;r=n;break}}}}}!h.linearRing||p[p.length-1][0]===C[0]&&p[p.length-1][1]===C[1]||p.push(C);a.push(p)}b=a}"function"===typeof h.successCallback&&h.successCallback(b);
return b}});
